parameters:
- name: pipelineId
  type: string
- name: loggedInToDevops
  type: boolean
  default: false

steps:
- ${{ if eq(parameters.loggedInToDevops, false) }}:
  - bash: echo $(System.AccessToken) | az devops login
    displayName: Login to devops

- bash: |
    cat $(Build.Repository.LocalPath)/draft-jsons/base-body-for-invoke-pipeline-request.json > body.json
    cat body.json
  displayName: cat

- bash: |
    echo param pipelineId: ${{ parameters.pipelineId }}
  displayName: echo pipelineId

- bash: |
    az devops invoke \
    --area pipelines \
    --resource runs \
    --organization https://dev.azure.com/maciejkachniarz0364/ \
    --route-parameters project='az devops pipelines' pipelineId=16 \
    --http-method POST \
    --in-file body.json \
    --api-version=6.1-preview
  displayName: 'Invoke pipeline ${{ parameters.pipelineId }}'